<div class="role-management-container">
  <div class="category-header">
    <h3>Role Management</h3>
    <p>Role-based access control with creation, modification, and assignment capabilities</p>
  </div>

  <p-tabView class="nested-tabs">
    <!-- UI Interface Tab -->
    <p-tabPanel header="UI Interface" leftIcon="pi pi-desktop">
      <div class="role-ui-interface">
        <p-card header="Role Management Interface">
          <div class="ui-description">
            <p><i class="pi pi-info-circle"></i> Comprehensive interface for managing system roles and permissions.</p>
          </div>
          
          <div class="ui-features">
            <h4>Available Features:</h4>
            <div class="feature-grid">
              <div class="feature-card">
                <i class="pi pi-key"></i>
                <h5>Role List</h5>
                <p>Browse and search all system roles with pagination</p>
                <p-button label="View Roles" icon="pi pi-external-link" class="p-button-outlined" size="small" (onClick)="openRoleManagementUI('list')"></p-button>
              </div>
              <div class="feature-card">
                <i class="pi pi-plus-circle"></i>
                <h5>Create Role</h5>
                <p>Add new roles with specific permissions</p>
                <p-button label="Create Role" icon="pi pi-plus" class="p-button-outlined" size="small" (onClick)="openRoleManagementUI('create')"></p-button>
              </div>
              <div class="feature-card">
                <i class="pi pi-pencil"></i>
                <h5>Edit Role</h5>
                <p>Modify existing role properties and permissions</p>
                <p-button label="Edit Role" icon="pi pi-pencil" class="p-button-outlined" size="small" (onClick)="openRoleManagementUI('edit')"></p-button>
              </div>
              <div class="feature-card">
                <i class="pi pi-trash"></i>
                <h5>Delete Role</h5>
                <p>Remove roles from the system</p>
                <p-button label="Delete Role" icon="pi pi-trash" class="p-button-outlined" size="small" (onClick)="openRoleManagementUI('delete')"></p-button>
              </div>
              <div class="feature-card">
                <i class="pi pi-users"></i>
                <h5>Role Users</h5>
                <p>View users assigned to specific roles</p>
                <p-button label="View Users" icon="pi pi-users" class="p-button-outlined" size="small" (onClick)="openRoleManagementUI('users')"></p-button>
              </div>
            </div>
          </div>

          <p-divider></p-divider>

          <div class="quick-actions">
            <h4>Quick Actions:</h4>
            <div class="actions-row">
              <p-button 
                label="GetRoles" 
                icon="pi pi-list" 
                (onClick)="openEndpointTester('/api/Role', 'GET')"
                class="p-button-outlined"
              ></p-button>
              <p-button 
                label="InsertRoles" 
                icon="pi pi-plus" 
                (onClick)="openRoleManagementUI('create')"
                class="p-button-success"
              ></p-button>
              <p-button 
                label="UpdateRole" 
                icon="pi pi-pencil" 
                (onClick)="openRoleManagementUI('edit')"
                class="p-button-warning"
              ></p-button>
              <p-button 
                label="DeleteRole" 
                icon="pi pi-trash" 
                (onClick)="openRoleManagementUI('delete')"
                class="p-button-danger"
              ></p-button>
            </div>
          </div>
        </p-card>
      </div>
    </p-tabPanel>

    <!-- API Endpoints Tab -->
    <p-tabPanel header="API Endpoints" leftIcon="pi pi-code">
      <div class="api-endpoints-interface">
        <p-card header="Role Management API Endpoints">
          <div class="api-description">
            <p><i class="pi pi-info-circle"></i> Complete list of API endpoints for role management operations.</p>
          </div>

          <p-accordion>
            <p-accordionTab 
              *ngFor="let endpoint of roleManagementEndpoints"
              [header]="getAccordionHeader(endpoint)"
            >
              <div class="endpoint-details">
                <div class="endpoint-info">
                  <div class="endpoint-meta">
                    <p-chip 
                      [label]="endpoint.method" 
                      [class]="'method-' + endpoint.method.toLowerCase()"
                    ></p-chip>
                    <span class="endpoint-path">{{ endpoint.endpoint }}</span>
                    <p-badge 
                      *ngIf="endpoint.requiresAuth" 
                      value="AUTH" 
                      severity="warning"
                    ></p-badge>
                  </div>
                  <p class="endpoint-summary">{{ endpoint.summary }}</p>
                  
                  <div class="endpoint-parameters" *ngIf="endpoint.parameters && endpoint.parameters.length > 0">
                    <h5>Parameters:</h5>
                    <div class="parameters-list">
                      <p-chip 
                        *ngFor="let param of endpoint.parameters" 
                        [label]="param"
                        class="parameter-chip"
                      ></p-chip>
                    </div>
                  </div>

                  <div class="endpoint-actions">
                    <p-button 
                      label="Test Endpoint" 
                      icon="pi pi-play" 
                      size="small"
                      (onClick)="openEndpointTester(endpoint.endpoint, endpoint.method)"
                    ></p-button>
                    <p-button 
                      label="Copy cURL" 
                      icon="pi pi-copy" 
                      size="small"
                      class="p-button-outlined"
                      (onClick)="copyCurlCommand(endpoint)"
                    ></p-button>
                    <p-button 
                      label="View Schema" 
                      icon="pi pi-eye" 
                      size="small"
                      class="p-button-info"
                      (onClick)="viewEndpointSchema(endpoint)"
                    ></p-button>
                  </div>
                </div>
              </div>
            </p-accordionTab>
          </p-accordion>
        </p-card>
      </div>
    </p-tabPanel>
  </p-tabView>
</div>

<!-- Create Role Dialog -->
<p-dialog 
  header="Create New Role" 
  [(visible)]="showCreateRoleDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="create-role-dialog responsive-dialog"
>
  <form [formGroup]="createRoleForm" (ngSubmit)="handleCreateRole()">
    <div class="form-field">
      <label for="createRoleName">Role Name *</label>
      <input 
        pInputText 
        id="createRoleName" 
        formControlName="name" 
        placeholder="Enter role name"
        [class.ng-invalid]="createRoleForm.get('name')?.invalid && createRoleForm.get('name')?.touched"
      />
      <small class="p-error" *ngIf="createRoleForm.get('name')?.invalid && createRoleForm.get('name')?.touched">
        Role name is required
      </small>
    </div>

    <div class="form-field">
      <label for="createRoleDescription">Description</label>
      <input 
        pInputText 
        id="createRoleDescription" 
        formControlName="description" 
        placeholder="Enter role description"
      />
    </div>

    <div class="form-field">
      <p-checkbox 
        formControlName="isActive" 
        label="Active Role"
        inputId="createIsActive"
      ></p-checkbox>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Create Role" 
        icon="pi pi-plus" 
        [loading]="createRoleLoading"
        [disabled]="createRoleForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Cancel" 
        icon="pi pi-times" 
        class="p-button-secondary" 
        (onClick)="showCreateRoleDialog = false"
      ></p-button>
    </div>

    <p-message *ngIf="createRoleMessage" severity="info" [text]="createRoleMessage"></p-message>
  </form>
</p-dialog>

<!-- Edit Role Dialog -->
<p-dialog 
  header="Edit Role" 
  [(visible)]="showEditRoleDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="edit-role-dialog responsive-dialog"
>
  <form [formGroup]="editRoleForm" (ngSubmit)="handleEditRole()">
    <div class="form-field">
      <label for="editRoleId">Role ID *</label>
      <input 
        pInputText 
        id="editRoleId" 
        formControlName="id" 
        placeholder="Enter role ID"
        [class.ng-invalid]="editRoleForm.get('id')?.invalid && editRoleForm.get('id')?.touched"
      />
      <small class="p-error" *ngIf="editRoleForm.get('id')?.invalid && editRoleForm.get('id')?.touched">
        Role ID is required
      </small>
    </div>

    <div class="form-field">
      <label for="editRoleName">Role Name *</label>
      <input 
        pInputText 
        id="editRoleName" 
        formControlName="name" 
        placeholder="Enter role name"
        [class.ng-invalid]="editRoleForm.get('name')?.invalid && editRoleForm.get('name')?.touched"
      />
      <small class="p-error" *ngIf="editRoleForm.get('name')?.invalid && editRoleForm.get('name')?.touched">
        Role name is required
      </small>
    </div>

    <div class="form-field">
      <label for="editRoleDescription">Description</label>
      <input 
        pInputText 
        id="editRoleDescription" 
        formControlName="description" 
        placeholder="Enter role description"
      />
    </div>

    <div class="form-field">
      <p-checkbox 
        formControlName="isActive" 
        label="Active Role"
        inputId="editIsActive"
      ></p-checkbox>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Update Role" 
        icon="pi pi-check" 
        [loading]="editRoleLoading"
        [disabled]="editRoleForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Cancel" 
        icon="pi pi-times" 
        class="p-button-secondary" 
        (onClick)="showEditRoleDialog = false"
      ></p-button>
    </div>

    <p-message *ngIf="editRoleMessage" severity="info" [text]="editRoleMessage"></p-message>
  </form>
</p-dialog>

<!-- Search Roles Dialog -->
<p-dialog 
  header="Search Roles" 
  [(visible)]="showSearchRolesDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="search-roles-dialog responsive-dialog"
>
  <form [formGroup]="searchRolesForm" (ngSubmit)="handleSearchRoles()">
    <div class="search-form">
      <div class="form-field">
        <label for="searchTerm">Search Term</label>
        <input 
          pInputText 
          id="searchTerm" 
          formControlName="searchTerm" 
          placeholder="Enter role name or description"
        />
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="pageNumber">Page Number</label>
          <p-inputNumber 
            id="pageNumber" 
            formControlName="pageNumber" 
            [min]="1"
            [showButtons]="true"
          ></p-inputNumber>
        </div>

        <div class="form-field">
          <label for="pageSize">Page Size</label>
          <p-inputNumber 
            id="pageSize" 
            formControlName="pageSize" 
            [min]="1"
            [max]="100"
            [showButtons]="true"
          ></p-inputNumber>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Search" 
        icon="pi pi-search" 
        [loading]="searchRolesLoading"
      ></p-button>
      <p-button 
        type="button" 
        label="Clear" 
        icon="pi pi-refresh" 
        class="p-button-secondary" 
        (onClick)="searchRolesForm.reset(); searchResults = []"
      ></p-button>
    </div>

    <p-message *ngIf="searchRolesMessage" severity="info" [text]="searchRolesMessage"></p-message>

    <div class="search-results" *ngIf="searchResults.length > 0">
      <h4>Search Results:</h4>
      <div class="role-list">
        <div 
          *ngFor="let role of searchResults" 
          class="role-item"
          (click)="selectRole(role)"
          [class.selected]="selectedRole?.id === role.id"
        >
          <div class="role-info">
            <h5>{{ role.name }}</h5>
            <p>{{ role.description }}</p>
            <small>ID: {{ role.id }}</small>
          </div>
          <div class="role-status">
            <p-badge 
              [value]="role.isActive ? 'Active' : 'Inactive'" 
              [severity]="role.isActive ? 'success' : 'danger'"
            ></p-badge>
          </div>
        </div>
      </div>
    </div>
  </form>
</p-dialog>

<!-- Role Users Dialog -->
<p-dialog 
  header="Role Users" 
  [(visible)]="showRoleUsersDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="role-users-dialog responsive-dialog"
>
  <form [formGroup]="roleUsersForm" (ngSubmit)="handleGetRoleUsers()">
    <div class="form-field">
      <label for="roleUsersId">Role ID *</label>
      <input 
        pInputText 
        id="roleUsersId" 
        formControlName="roleId" 
        placeholder="Enter role ID"
        [class.ng-invalid]="roleUsersForm.get('roleId')?.invalid && roleUsersForm.get('roleId')?.touched"
      />
      <small class="p-error" *ngIf="roleUsersForm.get('roleId')?.invalid && roleUsersForm.get('roleId')?.touched">
        Role ID is required
      </small>
    </div>

    <div class="form-row">
      <div class="form-field">
        <label for="usersPageNumber">Page Number</label>
        <p-inputNumber 
          id="usersPageNumber" 
          formControlName="pageNumber" 
          [min]="1"
          [showButtons]="true"
        ></p-inputNumber>
      </div>

      <div class="form-field">
        <label for="usersPageSize">Page Size</label>
        <p-inputNumber 
          id="usersPageSize" 
          formControlName="pageSize" 
          [min]="1"
          [max]="100"
          [showButtons]="true"
        ></p-inputNumber>
      </div>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Get Users" 
        icon="pi pi-users" 
        [loading]="roleUsersLoading"
        [disabled]="roleUsersForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Clear" 
        icon="pi pi-refresh" 
        class="p-button-secondary" 
        (onClick)="roleUsersForm.reset(); roleUsers = []"
      ></p-button>
    </div>

    <p-message *ngIf="roleUsersMessage" severity="info" [text]="roleUsersMessage"></p-message>

    <div class="users-results" *ngIf="roleUsers.length > 0">
      <h4>Users in Role:</h4>
      <div class="user-list">
        <div 
          *ngFor="let user of roleUsers" 
          class="user-item"
        >
          <div class="user-info">
            <h5>{{ user.userName || user.email }}</h5>
            <p>{{ user.firstName }} {{ user.lastName }}</p>
            <small>{{ user.email }}</small>
          </div>
          <div class="user-status">
            <p-badge 
              [value]="user.isActive ? 'Active' : 'Inactive'" 
              [severity]="user.isActive ? 'success' : 'danger'"
            ></p-badge>
          </div>
        </div>
      </div>
    </div>
  </form>
</p-dialog>

<!-- Delete Role Dialog -->
<p-dialog 
  header="Delete Role" 
  [(visible)]="showDeleteRoleDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="delete-role-dialog responsive-dialog"
>
  <div class="delete-confirmation">
    <div class="warning-icon">
      <i class="pi pi-exclamation-triangle"></i>
    </div>
    <div class="confirmation-message">
      <p><strong>Are you sure you want to delete this role?</strong></p>
      <p>This action cannot be undone. All users assigned to this role will lose their permissions.</p>
      
      <div class="selected-role-info" *ngIf="selectedRole">
        <p><strong>Selected Role:</strong></p>
        <div class="role-details">
          <p><strong>Name:</strong> {{ selectedRole.name }}</p>
          <p><strong>ID:</strong> {{ selectedRole.id }}</p>
          <p *ngIf="selectedRole.description"><strong>Description:</strong> {{ selectedRole.description }}</p>
        </div>
      </div>
      
      <div *ngIf="!selectedRole" class="no-selection">
        <p><em>Please select a role from the search results first.</em></p>
      </div>
    </div>
  </div>

  <div class="form-actions">
    <p-button 
      label="Delete Role" 
      icon="pi pi-trash" 
      class="p-button-danger"
      [loading]="deleteRoleLoading"
      [disabled]="!selectedRole"
      (onClick)="handleDeleteRole()"
    ></p-button>
    <p-button 
      label="Cancel" 
      icon="pi pi-times" 
      class="p-button-secondary" 
      (onClick)="showDeleteRoleDialog = false"
    ></p-button>
  </div>

  <p-message *ngIf="deleteRoleMessage" severity="info" [text]="deleteRoleMessage"></p-message>
</p-dialog>