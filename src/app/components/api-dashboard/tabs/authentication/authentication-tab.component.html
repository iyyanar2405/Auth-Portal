<div class="authentication-container">
  <div class="category-header">
    <h3>Authentication</h3>
    <p>Core authentication endpoints for login, registration, and token management</p>
  </div>

  <p-tabView class="nested-tabs">
    <!-- UI Interface Tab -->
    <p-tabPanel header="UI Interface" leftIcon="pi pi-desktop">
      <div class="auth-ui-interface">
        <p-card header="Authentication Interface">
          <div class="ui-description">
            <p><i class="pi pi-info-circle"></i> A user-friendly interface for authentication operations with forms and visual components.</p>
          </div>
          
          <div class="ui-features">
            <h4>Available Features:</h4>
            <div class="feature-grid">
              <div class="feature-card">
                <i class="pi pi-sign-in"></i>
                <h5>User Login</h5>
                <p>Secure login with email and password</p>
                <p-button 
                  *ngIf="!isLoggedIn" 
                  label="Login Form" 
                  icon="pi pi-external-link" 
                  class="p-button-outlined" 
                  size="small" 
                  (onClick)="openAuthenticationUI('login')"
                ></p-button>
                <div *ngIf="isLoggedIn" class="logged-in-status">
                  <span class="login-status">âœ… Logged In</span>
                  <p-button 
                    label="Logout" 
                    icon="pi pi-sign-out" 
                    class="p-button-danger" 
                    size="small" 
                    (onClick)="logout()"
                  ></p-button>
                </div>
              </div>
              <div class="feature-card">
                <i class="pi pi-user-plus"></i>
                <h5>User Registration</h5>
                <p>Register new user accounts</p>
                <p-button label="Register" icon="pi pi-plus" class="p-button-outlined" size="small" (onClick)="openAuthenticationUI('register')"></p-button>
              </div>
              <div class="feature-card">
                <i class="pi pi-key"></i>
                <h5>Password Reset</h5>
                <p>Reset forgotten passwords</p>
                <p-button label="Reset Password" icon="pi pi-refresh" class="p-button-outlined" size="small" (onClick)="openAuthenticationUI('reset')"></p-button>
              </div>
              <div class="feature-card">
                <i class="pi pi-shield"></i>
                <h5>Token Management</h5>
                <p>Manage authentication tokens</p>
                <p-button label="Token Manager" icon="pi pi-cog" class="p-button-outlined" size="small" (onClick)="openAuthenticationUI('tokens')"></p-button>
              </div>
            </div>
          </div>

          <p-divider></p-divider>

          <div class="quick-actions">
            <h4>Quick Actions:</h4>
            <div class="actions-row">
              <p-button 
                label="Confirm Email" 
                icon="pi pi-envelope" 
                (onClick)="showConfirmEmailDialog = true"
                class="p-button-outlined"
              ></p-button>
              <p-button 
                label="Test Login" 
                icon="pi pi-sign-in" 
                (onClick)="openEndpointTester('/api/Authorize/token', 'POST')"
                class="p-button-outlined"
              ></p-button>
            </div>
          </div>
        </p-card>
      </div>
    </p-tabPanel>

    <!-- API Endpoints Tab -->
    <p-tabPanel header="API Endpoints" leftIcon="pi pi-code">
      <div class="api-endpoints-interface">
        <p-card header="Authentication API Endpoints">
          <div class="api-description">
            <p><i class="pi pi-info-circle"></i> Complete list of API endpoints for authentication operations.</p>
          </div>

          <p-accordion>
            <p-accordionTab 
              *ngFor="let endpoint of authenticationEndpoints"
              [header]="getAccordionHeader(endpoint)"
            >
              <div class="endpoint-details">
                <div class="endpoint-info">
                  <div class="endpoint-meta">
                    <p-chip 
                      [label]="endpoint.method" 
                      [class]="'method-' + endpoint.method.toLowerCase()"
                    ></p-chip>
                    <span class="endpoint-path">{{ endpoint.endpoint }}</span>
                    <p-badge 
                      *ngIf="endpoint.requiresAuth" 
                      value="AUTH" 
                      severity="warning"
                    ></p-badge>
                  </div>
                  <p class="endpoint-summary">{{ endpoint.summary }}</p>
                  
                  <div class="endpoint-parameters" *ngIf="endpoint.parameters && endpoint.parameters.length > 0">
                    <h5>Parameters:</h5>
                    <div class="parameters-list">
                      <p-chip 
                        *ngFor="let param of endpoint.parameters" 
                        [label]="param"
                        class="parameter-chip"
                      ></p-chip>
                    </div>
                  </div>

                  <div class="endpoint-actions">
                    <p-button 
                      label="Test Endpoint" 
                      icon="pi pi-play" 
                      size="small"
                      (onClick)="openEndpointTester(endpoint.endpoint, endpoint.method)"
                    ></p-button>
                    <p-button 
                      label="Copy cURL" 
                      icon="pi pi-copy" 
                      size="small"
                      class="p-button-outlined"
                      (onClick)="copyCurlCommand(endpoint)"
                    ></p-button>
                    <p-button 
                      label="View Schema" 
                      icon="pi pi-eye" 
                      size="small"
                      class="p-button-info"
                      (onClick)="viewEndpointSchema(endpoint)"
                    ></p-button>
                  </div>
                </div>
              </div>
            </p-accordionTab>
          </p-accordion>
        </p-card>
      </div>
    </p-tabPanel>
  </p-tabView>
</div>

<!-- Login Dialog -->
<p-dialog 
  header="User Login" 
  [(visible)]="showLoginDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="login-dialog"
>
  <form [formGroup]="loginForm" (ngSubmit)="handleLogin()">
    <div class="form-field">
      <label for="userName">Username/Email</label>
      <input 
        pInputText 
        id="userName" 
        formControlName="userName" 
        placeholder="Enter your username or email"
        [class.ng-invalid]="loginForm.get('userName')?.invalid && loginForm.get('userName')?.touched"
      />
      <small class="p-error" *ngIf="loginForm.get('userName')?.invalid && loginForm.get('userName')?.touched">
        Username/Email is required
      </small>
    </div>

    <div class="form-field">
      <label for="password">Password</label>
      <p-password 
        id="password" 
        formControlName="password" 
        placeholder="Enter your password"
        [feedback]="false"
        [toggleMask]="true"
        [class.ng-invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched"
      ></p-password>
      <small class="p-error" *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
        Password is required
      </small>
    </div>

    <div class="form-field">
      <label for="deviceCode">Device Code (Optional)</label>
      <input 
        pInputText 
        id="deviceCode" 
        formControlName="deviceCode" 
        placeholder="Enter device code if required"
      />
    </div>

    <div class="form-field">
      <p-checkbox 
        [(ngModel)]="rememberCredentials" 
        [ngModelOptions]="{standalone: true}"
        label="Remember username"
        inputId="rememberCredentials"
      ></p-checkbox>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Login" 
        icon="pi pi-sign-in" 
        [loading]="loginLoading"
        [disabled]="loginForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Cancel" 
        icon="pi pi-times" 
        class="p-button-secondary" 
        (onClick)="showLoginDialog = false"
      ></p-button>
    </div>

    <p-message *ngIf="loginMessage" severity="info" [text]="loginMessage"></p-message>
  </form>
</p-dialog>

<!-- Register Dialog -->
<p-dialog 
  header="User Registration" 
  [(visible)]="showRegisterDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="register-dialog"
>
  <form [formGroup]="registerForm" (ngSubmit)="handleRegister()">
    <div class="form-field">
      <label for="regUserName">Username (Optional)</label>
      <input 
        pInputText 
        id="regUserName" 
        formControlName="userName" 
        placeholder="Enter desired username"
      />
    </div>

    <div class="form-field">
      <label for="email">Email Address</label>
      <input 
        pInputText 
        id="email" 
        formControlName="email" 
        placeholder="Enter your email address"
        [class.ng-invalid]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
      />
      <small class="p-error" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
        Valid email address is required
      </small>
    </div>

    <div class="form-field">
      <label for="regPassword">Password</label>
      <p-password 
        id="regPassword" 
        formControlName="password" 
        placeholder="Enter your password"
        [feedback]="true"
        [toggleMask]="true"
        [class.ng-invalid]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
      ></p-password>
      <small class="p-error" *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
        Password must be at least 6 characters
      </small>
    </div>

    <div class="form-field">
      <label for="confirmPassword">Confirm Password</label>
      <p-password 
        id="confirmPassword" 
        formControlName="confirmPassword" 
        placeholder="Confirm your password"
        [feedback]="false"
        [toggleMask]="true"
        [class.ng-invalid]="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched"
      ></p-password>
      <small class="p-error" *ngIf="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched">
        Passwords must match
      </small>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Register" 
        icon="pi pi-user-plus" 
        [loading]="registerLoading"
        [disabled]="registerForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Cancel" 
        icon="pi pi-times" 
        class="p-button-secondary" 
        (onClick)="showRegisterDialog = false"
      ></p-button>
    </div>

    <p-message *ngIf="registerMessage" severity="info" [text]="registerMessage"></p-message>
  </form>
</p-dialog>

<!-- Forgot Password Dialog -->
<p-dialog 
  header="Forgot Password" 
  [(visible)]="showForgotPasswordDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="forgot-password-dialog"
>
  <form [formGroup]="forgotPasswordForm" (ngSubmit)="handleForgotPassword()">
    <div class="form-field">
      <label for="forgotEmail">Email Address</label>
      <input 
        pInputText 
        id="forgotEmail" 
        formControlName="email" 
        placeholder="Enter your email address"
        [class.ng-invalid]="forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched"
      />
      <small class="p-error" *ngIf="forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched">
        Valid email address is required
      </small>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Send Reset Email" 
        icon="pi pi-envelope" 
        [loading]="forgotPasswordLoading"
        [disabled]="forgotPasswordForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Cancel" 
        icon="pi pi-times" 
        class="p-button-secondary" 
        (onClick)="showForgotPasswordDialog = false"
      ></p-button>
    </div>

    <p-message *ngIf="forgotPasswordMessage" severity="info" [text]="forgotPasswordMessage"></p-message>
  </form>
</p-dialog>

<!-- Reset Password Dialog -->
<p-dialog 
  header="Reset Password" 
  [(visible)]="showResetPasswordDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="reset-password-dialog"
>
  <form [formGroup]="resetPasswordForm" (ngSubmit)="handleResetPassword()">
    <div class="form-field">
      <label for="userId">User ID</label>
      <input 
        pInputText 
        id="userId" 
        formControlName="userId" 
        placeholder="Enter your user ID"
        [class.ng-invalid]="resetPasswordForm.get('userId')?.invalid && resetPasswordForm.get('userId')?.touched"
      />
      <small class="p-error" *ngIf="resetPasswordForm.get('userId')?.invalid && resetPasswordForm.get('userId')?.touched">
        User ID is required
      </small>
    </div>

    <div class="form-field">
      <label for="resetCode">Reset Code</label>
      <input 
        pInputText 
        id="resetCode" 
        formControlName="code" 
        placeholder="Enter the reset code from email"
        [class.ng-invalid]="resetPasswordForm.get('code')?.invalid && resetPasswordForm.get('code')?.touched"
      />
      <small class="p-error" *ngIf="resetPasswordForm.get('code')?.invalid && resetPasswordForm.get('code')?.touched">
        Reset code is required
      </small>
    </div>

    <div class="form-field">
      <label for="newPassword">New Password</label>
      <p-password 
        id="newPassword" 
        formControlName="password" 
        placeholder="Enter your new password"
        [feedback]="true"
        [toggleMask]="true"
        [class.ng-invalid]="resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched"
      ></p-password>
      <small class="p-error" *ngIf="resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched">
        Password must be at least 6 characters
      </small>
    </div>

    <div class="form-field">
      <label for="confirmNewPassword">Confirm New Password</label>
      <p-password 
        id="confirmNewPassword" 
        formControlName="confirmPassword" 
        placeholder="Confirm your new password"
        [feedback]="false"
        [toggleMask]="true"
        [class.ng-invalid]="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched"
      ></p-password>
      <small class="p-error" *ngIf="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched">
        Passwords must match
      </small>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Reset Password" 
        icon="pi pi-key" 
        [loading]="resetPasswordLoading"
        [disabled]="resetPasswordForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Cancel" 
        icon="pi pi-times" 
        class="p-button-secondary" 
        (onClick)="showResetPasswordDialog = false"
      ></p-button>
    </div>

    <p-message *ngIf="resetPasswordMessage" severity="info" [text]="resetPasswordMessage"></p-message>
  </form>
</p-dialog>

<!-- Confirm Email Dialog -->
<p-dialog 
  header="Confirm Email" 
  [(visible)]="showConfirmEmailDialog" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="confirm-email-dialog"
>
  <form [formGroup]="confirmEmailForm" (ngSubmit)="handleConfirmEmail()">
    <div class="form-field">
      <label for="confirmUserId">User ID</label>
      <input 
        pInputText 
        id="confirmUserId" 
        formControlName="userId" 
        placeholder="Enter your user ID"
        [class.ng-invalid]="confirmEmailForm.get('userId')?.invalid && confirmEmailForm.get('userId')?.touched"
      />
      <small class="p-error" *ngIf="confirmEmailForm.get('userId')?.invalid && confirmEmailForm.get('userId')?.touched">
        User ID is required
      </small>
    </div>

    <div class="form-field">
      <label for="confirmCode">Confirmation Code</label>
      <input 
        pInputText 
        id="confirmCode" 
        formControlName="code" 
        placeholder="Enter the confirmation code from email"
        [class.ng-invalid]="confirmEmailForm.get('code')?.invalid && confirmEmailForm.get('code')?.touched"
      />
      <small class="p-error" *ngIf="confirmEmailForm.get('code')?.invalid && confirmEmailForm.get('code')?.touched">
        Confirmation code is required
      </small>
    </div>

    <div class="form-actions">
      <p-button 
        type="submit" 
        label="Confirm Email" 
        icon="pi pi-check" 
        [loading]="confirmEmailLoading"
        [disabled]="confirmEmailForm.invalid"
      ></p-button>
      <p-button 
        type="button" 
        label="Cancel" 
        icon="pi pi-times" 
        class="p-button-secondary" 
        (onClick)="showConfirmEmailDialog = false"
      ></p-button>
    </div>

    <p-message *ngIf="confirmEmailMessage" severity="info" [text]="confirmEmailMessage"></p-message>
  </form>
</p-dialog>